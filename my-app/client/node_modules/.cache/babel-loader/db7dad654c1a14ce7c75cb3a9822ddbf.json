{"ast":null,"code":"import { getFragmentQueryDocument } from 'apollo-utilities';\nfunction queryFromPojo(obj) {\n  var op = {\n    kind: 'OperationDefinition',\n    operation: 'query',\n    name: {\n      kind: 'Name',\n      value: 'GeneratedClientQuery'\n    },\n    selectionSet: selectionSetFromObj(obj)\n  };\n  var out = {\n    kind: 'Document',\n    definitions: [op]\n  };\n  return out;\n}\nfunction fragmentFromPojo(obj, typename) {\n  var frag = {\n    kind: 'FragmentDefinition',\n    typeCondition: {\n      kind: 'NamedType',\n      name: {\n        kind: 'Name',\n        value: typename || '__FakeType'\n      }\n    },\n    name: {\n      kind: 'Name',\n      value: 'GeneratedClientQuery'\n    },\n    selectionSet: selectionSetFromObj(obj)\n  };\n  var out = {\n    kind: 'Document',\n    definitions: [frag]\n  };\n  return out;\n}\nfunction selectionSetFromObj(obj) {\n  if (typeof obj === 'number' || typeof obj === 'boolean' || typeof obj === 'string' || typeof obj === 'undefined' || obj === null) {\n    return null;\n  }\n  if (Array.isArray(obj)) {\n    return selectionSetFromObj(obj[0]);\n  }\n  var selections = [];\n  Object.keys(obj).forEach(function (key) {\n    var nestedSelSet = selectionSetFromObj(obj[key]);\n    var field = {\n      kind: 'Field',\n      name: {\n        kind: 'Name',\n        value: key\n      },\n      selectionSet: nestedSelSet || undefined\n    };\n    selections.push(field);\n  });\n  var selectionSet = {\n    kind: 'SelectionSet',\n    selections: selections\n  };\n  return selectionSet;\n}\nvar justTypenameQuery = {\n  kind: 'Document',\n  definitions: [{\n    kind: 'OperationDefinition',\n    operation: 'query',\n    name: null,\n    variableDefinitions: null,\n    directives: [],\n    selectionSet: {\n      kind: 'SelectionSet',\n      selections: [{\n        kind: 'Field',\n        alias: null,\n        name: {\n          kind: 'Name',\n          value: '__typename'\n        },\n        arguments: [],\n        directives: [],\n        selectionSet: null\n      }]\n    }\n  }]\n};\nvar ApolloCache = function () {\n  function ApolloCache() {}\n  ApolloCache.prototype.transformDocument = function (document) {\n    return document;\n  };\n  ApolloCache.prototype.transformForLink = function (document) {\n    return document;\n  };\n  ApolloCache.prototype.readQuery = function (options, optimistic) {\n    if (optimistic === void 0) {\n      optimistic = false;\n    }\n    return this.read({\n      query: options.query,\n      variables: options.variables,\n      optimistic: optimistic\n    });\n  };\n  ApolloCache.prototype.readFragment = function (options, optimistic) {\n    if (optimistic === void 0) {\n      optimistic = false;\n    }\n    return this.read({\n      query: getFragmentQueryDocument(options.fragment, options.fragmentName),\n      variables: options.variables,\n      rootId: options.id,\n      optimistic: optimistic\n    });\n  };\n  ApolloCache.prototype.writeQuery = function (options) {\n    this.write({\n      dataId: 'ROOT_QUERY',\n      result: options.data,\n      query: options.query,\n      variables: options.variables\n    });\n  };\n  ApolloCache.prototype.writeFragment = function (options) {\n    this.write({\n      dataId: options.id,\n      result: options.data,\n      variables: options.variables,\n      query: getFragmentQueryDocument(options.fragment, options.fragmentName)\n    });\n  };\n  ApolloCache.prototype.writeData = function (_a) {\n    var id = _a.id,\n      data = _a.data;\n    if (typeof id !== 'undefined') {\n      var typenameResult = null;\n      try {\n        typenameResult = this.read({\n          rootId: id,\n          optimistic: false,\n          query: justTypenameQuery\n        });\n      } catch (e) {}\n      var __typename = typenameResult && typenameResult.__typename || '__ClientData';\n      var dataToWrite = Object.assign({\n        __typename: __typename\n      }, data);\n      this.writeFragment({\n        id: id,\n        fragment: fragmentFromPojo(dataToWrite, __typename),\n        data: dataToWrite\n      });\n    } else {\n      this.writeQuery({\n        query: queryFromPojo(data),\n        data: data\n      });\n    }\n  };\n  return ApolloCache;\n}();\nvar Cache;\n(function (Cache) {})(Cache || (Cache = {}));\nexport { ApolloCache, Cache };","map":{"version":3,"names":["queryFromPojo","obj","op","kind","operation","name","value","selectionSet","selectionSetFromObj","out","definitions","fragmentFromPojo","typename","frag","typeCondition","Array","isArray","selections","Object","keys","forEach","key","nestedSelSet","field","undefined","push","justTypenameQuery","variableDefinitions","directives","alias","arguments","ApolloCache","prototype","transformDocument","document","transformForLink","readQuery","options","optimistic","read","query","variables","readFragment","getFragmentQueryDocument","fragment","fragmentName","rootId","id","writeQuery","write","dataId","result","data","writeFragment","writeData","_a","typenameResult","e","__typename","dataToWrite","assign","Cache"],"sources":["../src/utils.ts","../src/cache.ts","../src/types/Cache.ts"],"sourcesContent":["import {\n  DocumentNode,\n  OperationDefinitionNode,\n  SelectionSetNode,\n  FieldNode,\n  FragmentDefinitionNode,\n} from 'graphql';\n\nexport function queryFromPojo(obj: any): DocumentNode {\n  const op: OperationDefinitionNode = {\n    kind: 'OperationDefinition',\n    operation: 'query',\n    name: {\n      kind: 'Name',\n      value: 'GeneratedClientQuery',\n    },\n    selectionSet: selectionSetFromObj(obj),\n  };\n\n  const out: DocumentNode = {\n    kind: 'Document',\n    definitions: [op],\n  };\n\n  return out;\n}\n\nexport function fragmentFromPojo(obj: any, typename?: string): DocumentNode {\n  const frag: FragmentDefinitionNode = {\n    kind: 'FragmentDefinition',\n    typeCondition: {\n      kind: 'NamedType',\n      name: {\n        kind: 'Name',\n        value: typename || '__FakeType',\n      },\n    },\n    name: {\n      kind: 'Name',\n      value: 'GeneratedClientQuery',\n    },\n    selectionSet: selectionSetFromObj(obj),\n  };\n\n  const out: DocumentNode = {\n    kind: 'Document',\n    definitions: [frag],\n  };\n\n  return out;\n}\n\nfunction selectionSetFromObj(obj: any): SelectionSetNode {\n  if (\n    typeof obj === 'number' ||\n    typeof obj === 'boolean' ||\n    typeof obj === 'string' ||\n    typeof obj === 'undefined' ||\n    obj === null\n  ) {\n    // No selection set here\n    return null;\n  }\n\n  if (Array.isArray(obj)) {\n    // GraphQL queries don't include arrays\n    return selectionSetFromObj(obj[0]);\n  }\n\n  // Now we know it's an object\n  const selections: FieldNode[] = [];\n\n  Object.keys(obj).forEach(key => {\n    const nestedSelSet: SelectionSetNode = selectionSetFromObj(obj[key]);\n\n    const field: FieldNode = {\n      kind: 'Field',\n      name: {\n        kind: 'Name',\n        value: key,\n      },\n      selectionSet: nestedSelSet || undefined,\n    };\n\n    selections.push(field);\n  });\n\n  const selectionSet: SelectionSetNode = {\n    kind: 'SelectionSet',\n    selections,\n  };\n\n  return selectionSet;\n}\n\nexport const justTypenameQuery: DocumentNode = {\n  kind: 'Document',\n  definitions: [\n    {\n      kind: 'OperationDefinition',\n      operation: 'query',\n      name: null,\n      variableDefinitions: null,\n      directives: [],\n      selectionSet: {\n        kind: 'SelectionSet',\n        selections: [\n          {\n            kind: 'Field',\n            alias: null,\n            name: {\n              kind: 'Name',\n              value: '__typename',\n            },\n            arguments: [],\n            directives: [],\n            selectionSet: null,\n          },\n        ],\n      },\n    },\n  ],\n};\n","import { DocumentNode } from 'graphql';\nimport { getFragmentQueryDocument } from 'apollo-utilities';\n\nimport { DataProxy, Cache } from './types';\nimport { justTypenameQuery, queryFromPojo, fragmentFromPojo } from './utils';\n\nexport type Transaction<T> = (c: ApolloCache<T>) => void;\n\nexport abstract class ApolloCache<TSerialized> implements DataProxy {\n  // required to implement\n  // core API\n  public abstract read<T, TVariables = any>(\n    query: Cache.ReadOptions<TVariables>,\n  ): T | null;\n  public abstract write<TResult = any, TVariables = any>(\n    write: Cache.WriteOptions<TResult, TVariables>,\n  ): void;\n  public abstract diff<T>(query: Cache.DiffOptions): Cache.DiffResult<T>;\n  public abstract watch(watch: Cache.WatchOptions): () => void;\n  public abstract evict<TVariables = any>(\n    query: Cache.EvictOptions<TVariables>,\n  ): Cache.EvictionResult;\n  public abstract reset(): Promise<void>;\n\n  // intializer / offline / ssr API\n  /**\n   * Replaces existing state in the cache (if any) with the values expressed by\n   * `serializedState`.\n   *\n   * Called when hydrating a cache (server side rendering, or offline storage),\n   * and also (potentially) during hot reloads.\n   */\n  public abstract restore(\n    serializedState: TSerialized,\n  ): ApolloCache<TSerialized>;\n\n  /**\n   * Exposes the cache's complete state, in a serializable format for later restoration.\n   */\n  public abstract extract(optimistic?: boolean): TSerialized;\n\n  // optimistic API\n  public abstract removeOptimistic(id: string): void;\n\n  // transactional API\n  public abstract performTransaction(\n    transaction: Transaction<TSerialized>,\n  ): void;\n  public abstract recordOptimisticTransaction(\n    transaction: Transaction<TSerialized>,\n    id: string,\n  ): void;\n\n  // optional API\n  public transformDocument(document: DocumentNode): DocumentNode {\n    return document;\n  }\n  // experimental\n  public transformForLink(document: DocumentNode): DocumentNode {\n    return document;\n  }\n\n  // DataProxy API\n  /**\n   *\n   * @param options\n   * @param optimistic\n   */\n  public readQuery<QueryType, TVariables = any>(\n    options: DataProxy.Query<TVariables>,\n    optimistic: boolean = false,\n  ): QueryType | null {\n    return this.read({\n      query: options.query,\n      variables: options.variables,\n      optimistic,\n    });\n  }\n\n  public readFragment<FragmentType, TVariables = any>(\n    options: DataProxy.Fragment<TVariables>,\n    optimistic: boolean = false,\n  ): FragmentType | null {\n    return this.read({\n      query: getFragmentQueryDocument(options.fragment, options.fragmentName),\n      variables: options.variables,\n      rootId: options.id,\n      optimistic,\n    });\n  }\n\n  public writeQuery<TData = any, TVariables = any>(\n    options: Cache.WriteQueryOptions<TData, TVariables>,\n  ): void {\n    this.write({\n      dataId: 'ROOT_QUERY',\n      result: options.data,\n      query: options.query,\n      variables: options.variables,\n    });\n  }\n\n  public writeFragment<TData = any, TVariables = any>(\n    options: Cache.WriteFragmentOptions<TData, TVariables>,\n  ): void {\n    this.write({\n      dataId: options.id,\n      result: options.data,\n      variables: options.variables,\n      query: getFragmentQueryDocument(options.fragment, options.fragmentName),\n    });\n  }\n\n  public writeData<TData = any>({\n    id,\n    data,\n  }: Cache.WriteDataOptions<TData>): void {\n    if (typeof id !== 'undefined') {\n      let typenameResult = null;\n      // Since we can't use fragments without having a typename in the store,\n      // we need to make sure we have one.\n      // To avoid overwriting an existing typename, we need to read it out first\n      // and generate a fake one if none exists.\n      try {\n        typenameResult = this.read<any>({\n          rootId: id,\n          optimistic: false,\n          query: justTypenameQuery,\n        });\n      } catch (e) {\n        // Do nothing, since an error just means no typename exists\n      }\n\n      // tslint:disable-next-line\n      const __typename =\n        (typenameResult && typenameResult.__typename) || '__ClientData';\n\n      // Add a type here to satisfy the inmemory cache\n      const dataToWrite = Object.assign({ __typename }, data);\n\n      this.writeFragment({\n        id,\n        fragment: fragmentFromPojo(dataToWrite, __typename),\n        data: dataToWrite,\n      });\n    } else {\n      this.writeQuery({ query: queryFromPojo(data), data });\n    }\n  }\n}\n","import { DataProxy } from './DataProxy';\n\nexport namespace Cache {\n  export type WatchCallback = (newData: any) => void;\n  export interface EvictionResult {\n    success: Boolean;\n  }\n\n  export interface ReadOptions<TVariables = any>\n    extends DataProxy.Query<TVariables> {\n    rootId?: string;\n    previousResult?: any;\n    optimistic: boolean;\n  }\n\n  export interface WriteOptions<TResult = any, TVariables = any>\n    extends DataProxy.Query<TVariables> {\n    dataId: string;\n    result: TResult;\n  }\n\n  export interface DiffOptions extends ReadOptions {\n    returnPartialData?: boolean;\n  }\n\n  export interface WatchOptions extends ReadOptions {\n    callback: WatchCallback;\n  }\n\n  export interface EvictOptions<TVariables = any>\n    extends DataProxy.Query<TVariables> {\n    rootId?: string;\n  }\n\n  export import DiffResult = DataProxy.DiffResult;\n  export import WriteQueryOptions = DataProxy.WriteQueryOptions;\n  export import WriteFragmentOptions = DataProxy.WriteFragmentOptions;\n  export import WriteDataOptions = DataProxy.WriteDataOptions;\n  export import Fragment = DataProxy.Fragment;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}